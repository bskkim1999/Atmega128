#define F_CPU 16000000UL
#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "UART0.h"

FILE OUTPUT = FDEV_SETUP_STREAM(UART0_transmit, NULL, _FDEV_SETUP_WRITE);
FILE INPUT = FDEV_SETUP_STREAM(NULL, UART0_receive, _FDEV_SETUP_READ);

const unsigned char steps[8] = {0x01,0x03,0x02,0x06,0x04,0x0c,0x08,0x09};

////////////////////////////////////////////////////////////////////////////////////

void clockwise_func(void){
	
	// 8steps
	for(int i=0 ; i<8 ; i++){
		PORTB = steps[i];
		_delay_ms(1);
	}
	
	
}

void counter_clockwise_func(void){
	
	// 8steps
	for(int i=7 ; i>=0 ; i--){
		PORTB = steps[i];
		_delay_ms(1);
	}
	
	
}




///////////////////////////////////////////////////////////////////////////////////


int main() {
	
	int angle_steps;
	int direction;
	
	stdout = &OUTPUT;
	stdin = &INPUT;
	
	
	/*uart*/
	UART0_init();
	
	
	
	DDRB = 0xff;
	
	
	
	while(1){
		
		
		printf("input angle and direction(cw:1, ccw:-1)(ex : 180 1) : ");
		scanf("%d %d", &angle_steps, &direction);
		//angle_steps = atof(angle);  //string -> double
		angle_steps = angle_steps * 1.4222222;
		
		if(direction==1){
			for(int i=0 ; i<angle_steps ; i++){
				clockwise_func();
			}
		}
		
		else if(direction==-1){
			for(int i=0 ; i<angle_steps ; i++){
				counter_clockwise_func();
			}
		}
		
		else{
			continue;
		}
		
		
	}
	
	
	
	
	
	
	return 0;
}
